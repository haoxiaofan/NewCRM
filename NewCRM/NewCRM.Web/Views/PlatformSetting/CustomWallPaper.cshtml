@{
    Layout = "~/Views/Shared/_LayoutApps.cshtml";
}
<script src="~/Scripts/HoorayUI/js/webuploader-0.1.5/webuploader.js"></script>
<div class="title">
    <ul>
        <li class="focus">壁纸设置</li>
        <li><a href="@Url.Action("SettingSkin", "PlatformSetting")">皮肤设置</a></li>
    </ul>
</div>
<div class="wallpapertype form-inline">
    <div class="btn-group fl">
        <a class="btn" href="@Url.Action("SystemWallPaper", "PlatformSetting")">系统壁纸</a><a class="btn disabled">自定义</a>
    </div>
    <div class="fr">
        <label>显示方式：</label>
        <select name="wallpapertype" id="wallpapertype" style="width:100px">
            <option value="tianchong">填充</option>
            <option value="shiying">适应</option>
            <option value="pingpu">平铺</option>
            <option value="lashen">拉伸</option>
            <option value="juzhong">居中</option>
        </select>
    </div>
</div>
<div class="wapppapercustom">
    <div class="tip">
        <a href="javascript:;" id="upload" class="btn btn-mini fr" style="position:relative">上传壁纸</a>
        <strong>自定义壁纸：</strong>最多上传6张，每张上传的壁纸大小不超过1M
    </div>
    <div class="view">
        <ul></ul>
    </div>
</div>
<div class="wapppaperwebsite form-inline">
    <label>网络壁纸：</label>
    <div class="input-append">
        <input type="text" id="wallpaperurl" style="width:350px" placeholder="请输入一个URL地址（建议以 jpg, jpeg, png, gif, html, htm 结尾）" value=""><button type="button" class="btn" onclick="javascript: SetWebWallPaper();">应用</button>
    </div>
</div>
<script>
    $(function () {
        var uploader = WebUploader.create({
            // 选完文件后，是否自动上传。
            auto: true,
            // swf文件路径
            swf: '../../js/webuploader-0.1.5/Uploader.swf',
            // 文件接收服务端。
            server: '@Url.Action("UploadWallPaper", "PlatformSetting")',
            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: {
                id: '#upload',
                multiple: false
            },
            // 只允许选择图片文件。
            accept: {
                title: 'Images',
                extensions: 'gif,jpg,jpeg,bmp,png',
                mimeTypes: 'image/*'
            }
        });
        uploader.on('beforeFileQueued', function (file) {
            if (file.size > 1000 * 1024) {
                ZENG.msgbox.show('文件大于1000Kb', 5, 2000);
                return false;
            }
        });
        uploader.on('uploadSuccess', function (file, cb) {
            if (typeof (cb.value) !== 'undefined' && cb.value === 0) {
                ZENG.msgbox.show("最多只能上传6张壁纸", 5, 2000);
            }
            $('.wapppapercustom .view ul').append('<li id="' + cb.Id + '" style="background-image:url(' + cb.Url + ')"><a href="javascript:;">删 除</a></li>');
            window.parent.HROS.wallpaper.update($('#wallpapertype').val(), cb.Id);
            uploader.removeFile(file);
        });
        $('#wallpapertype').on('change', function () {
            window.parent.HROS.wallpaper.update($('#wallpapertype').val(), '');

        });
        $('.wapppapercustom .view').on('click', 'li', function () {
            window.parent.HROS.wallpaper.update($('#wallpapertype').val(), $(this).attr('id'));
        });
        $('.wapppapercustom .view').on('click', 'li a', function (event) {
            event.stopPropagation();
            var id = $(this).parent().attr('id');
            $.post("@Url.Action("DeleteWallPaper", "PlatformSetting")", { wallPaperId: id }, function (result) {
                if (parseInt(result.data) === 1) {
                    $('#' + id).remove();
                } else {
                    ZENG.msgbox.show('当前壁纸正在使用或已被删除', 5, 2000);
                }
            });
        });
        $('.wapppaperwebsite button').on('click', function () {
            window.parent.HROS.wallpaper.update(3, $('#wallpapertype').val(), $('#wallpaperurl').val());
        });


        GetAllUploadWallPaper();
        setTimeout(function () {
            $('input[type="file"]').hide();
        }, 100);
    });

    function GetAllUploadWallPaper() {
        $.get("@Url.Action("GetAllUploadWallPaper", "PlatformSetting")", { __: Date.now() }, function (result) {
            var liElement = '';
            $.each(result.data, function (k, v) {
                liElement += '<li id="' + v.Id + '" style="background:url(' + v.SmallUrl + ')"><a href="javascript:;">删 除</a></li>';
            });
            $('.view').children('ul').append(liElement);
        });
    }

    function SetWebWallPaper() {
        var webUrl = $('#wallpaperurl').val();
        $.post("@Url.Action("SetWebWallPaper", "PlatformSetting")", { webUrl: webUrl }, function (result) {
            debugger;
            if (parseInt(result.Id) === 0) {
                ZENG.msgbox.show('未能获取到所指定的网络图片', 5, 2000);
            } else {
                window.parent.HROS.wallpaper.update($('#wallpapertype').val(), parseInt(result.Id));
            }
        });
    }
</script>
