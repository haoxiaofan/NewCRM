@{
    Layout = "~/Views/Shared/_LayoutApps.cshtml";
}

<div class="title">
    <ul>
        <li><a href="@Url.Action("SystemWallPaper", "DeskOptions")">壁纸设置</a></li>
        <li class="focus">皮肤设置</li>
    </ul>
</div>
<ul class="skin" id="skinList"></ul>
@section ChildrenScript
{
    <script>
        $(function () {
            
            loadAllSkin(function () {
                changeSkin();
            });
        });


        function loadAllSkin(callback) {
            ZENG.msgbox.show('正在加载中，请稍后...', 6, 8000);
            $.post('@Url.Action("GetAllSkin", "DeskOptions")', { __: Date.now }, function (responseText) {
                ZENG.msgbox._hide();
                if (typeof responseText.data !== 'undefined') {
                    var html = '';
                    $.each(responseText.data, function (k, v) {
                        html += '<li skin="' + k + '"><img src="' + v.imgPath + '"  data-css="' + v.skinPath + '"><div></div></li>';
                    });
                    $('#skinList').append(html);
                    $('li[skin="' + responseText.currentSkin + '"]').addClass('selected');
                    if (typeof (callback) === 'function') {
                        callback && callback();
                    }
                }
            });
        }

        function changeSkin() {
            $('.skin li').on('click', function () {
                var skin = $(this).attr('skin');
                $('.skin li').removeClass('selected');
                $(this).addClass('selected');
                $.post('@Url.Action("ModifySkin", "DeskOptions")', { __: Date.now(), skin: skin }, function (responseText) {

                    if (typeof responseText.js !== 'undefined') {
                        $('body').append(responseText.js);
                    } else {
                        if (typeof responseText.success !== 'undefined') {
                            window.parent.ZENG.msgbox.show("皮肤设置成功，如果没有更新请刷新页面", 4, 2000);

                            setTimeout(function () {
                                window.parent.HROS.base.getSkin(skin, function () {
                                    window.parent.ZENG.msgbox._hide();
                                });
                            }, 2000);
                        }
                    }

                });
            });
        }
    </script>
}
