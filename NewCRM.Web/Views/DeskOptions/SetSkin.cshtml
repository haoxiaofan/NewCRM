@{
    Layout = "~/Views/Shared/_LayoutApps.cshtml";
}

<div class="title">
    <ul>
        <li><a href="@Url.Action("SystemWallPaper", "DeskOptions")">壁纸设置</a></li>
        <li class="focus">皮肤设置</li>
    </ul>
</div>
<ul class="skin" id="skinList"></ul>
@section ChildrenScript
{
    <script>
        $(function () {
            loadAllSkin(function () {
                changeSkin();
            });
        });


        function loadAllSkin(callback) {
            ZENG.msgbox.loading('正在加载中，请稍后...');
            $.get('@Url.Action("GetSkins", "DeskOptions")', { __: Date.now }, function (responseText) {
                //ZENG.msgbox.hide();
                if (responseText.IsSuccess) {
                    var html = '';
                    $.each(responseText.Model.data, function (k, v) {
                        html += '<li skin="' + k + '"><img src="' + v.imgPath + '"  data-css="' + v.skinPath + '"><div></div></li>';
                    });
                    $('#skinList').append(html);
                    $('li[skin="' + responseText.Model.currentSkin + '"]').addClass('selected');
                    if (typeof (callback) === 'function') {
                        callback && callback();
                    }
                } else {
                    ZENG.msgbox.fail(responseText.Message);
                }
            });
        }

        function changeSkin() {
            $('.skin li').on('click', function () {
                var skin = $(this).attr('skin');
                $('.skin li').removeClass('selected');
                $(this).addClass('selected');
                $.post('@Url.Action("ModifySkin", "DeskOptions")', { __: Date.now(), skin: skin }, function (responseText) {
                    if (responseText.IsSuccess) {
                        window.parent.ZENG.msgbox.success("皮肤设置成功，如果没有更新请刷新页面");
                        setTimeout(function () {
                            window.parent.HROS.base.getSkin(skin, function () {
                                //window.parent.ZENG.msgbox.hide();
                            });
                        }, 2000);
                    } else {
                        ZENG.msgbox.fail(responseText.Message);
                    }
                });
            });
        }
    </script>
}
